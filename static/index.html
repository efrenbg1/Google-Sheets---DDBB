<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
        integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">

    <title>Hello, world!</title>
    <style>
        body {
            background-image: linear-gradient(to bottom right, #0087F9, #273B54);
            min-height: 100vh;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="row">
            <div class="col-sm">
                <div class="jumbotron my-4">
                    <h1 class="display-4">
                        <span class="text-success">
                            <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-file-earmark-spreadsheet"
                                fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd"
                                    d="M5 10H3V9h10v1h-3v2h3v1h-3v2H9v-2H6v2H5v-2H3v-1h2v-2zm1 0v2h3v-2H6z" />
                                <path
                                    d="M4 0h5.5v1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4.5h1V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2z" />
                                <path d="M9.5 3V0L14 4.5h-3A1.5 1.5 0 0 1 9.5 3z" />
                            </svg>
                        </span>
                        <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-arrow-right" fill="currentColor"
                            xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd"
                                d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8z" />
                        </svg>
                        <span class="text-warning">
                            <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-server" fill="currentColor"
                                xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd"
                                    d="M1.333 2.667C1.333 1.194 4.318 0 8 0s6.667 1.194 6.667 2.667V4C14.665 5.474 11.68 6.667 8 6.667 4.318 6.667 1.333 5.473 1.333 4V2.667zm0 3.667v3C1.333 10.805 4.318 12 8 12c3.68 0 6.665-1.193 6.667-2.665V6.334c-.43.32-.931.58-1.458.79C11.81 7.684 9.967 8 8 8c-1.967 0-3.81-.317-5.21-.876a6.508 6.508 0 0 1-1.457-.79zm13.334 5.334c-.43.319-.931.578-1.458.789-1.4.56-3.242.876-5.209.876-1.967 0-3.81-.316-5.21-.876a6.51 6.51 0 0 1-1.457-.79v1.666C1.333 14.806 4.318 16 8 16s6.667-1.194 6.667-2.667v-1.665z" />
                            </svg>
                        </span>
                    </h1>
                    <p class="lead">Turn your Google Spreadsheets into a <b>JSON</b> database for static sites</p>
                    <hr class="my-4">
                    <div id="alert"></div>
                    <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
                        <li class="nav-item" role="presentation">
                            <a class="nav-link" id="data-tab" data-toggle="pill" href="#data" role="tab"
                                aria-controls="data" aria-selected="false">Fill data</a>
                        </li>
                        <li class="nav-item" role="presentation">
                            <a class="nav-link active" id="link-tab" data-toggle="pill" href="#link" role="tab"
                                aria-controls="link" aria-selected="true">Get link</a>
                        </li>
                        <li class="nav-item" role="presentation">
                            <a class="nav-link" id="usage-tab" data-toggle="pill" href="#usage" role="tab"
                                aria-controls="usage" aria-selected="false">Usage</a>
                        </li>
                        <li class="nav-item" role="presentation">
                            <a class="nav-link" id="refresh-tab" data-toggle="pill" href="#refresh" role="tab"
                                aria-controls="refresh" aria-selected="false">Refresh</a>
                        </li>
                        <li class="nav-item" role="presentation">
                            <a class="nav-link" id="about-tab" data-toggle="pill" href="#about" role="tab"
                                aria-controls="about" aria-selected="false">About</a>
                        </li>
                    </ul>
                    <div class="tab-content" id="pills-tabContent">
                        <div class="tab-pane fade" id="data" role="tabpanel" aria-labelledby="data-tab">
                            <p>
                                <b>1.</b> Go to <a class="text-success" href="https://docs.google.com/spreadsheets"
                                    target="_blank">Google
                                    Spreadsheets</a> and create a new one
                            </p>
                            <p>
                                <b>2.</b> Place data only in the first Sheet like this:
                            </p>
                            <img src="img/spreadsheet1.png" class="img-fluid mb-3 rounded mx-auto d-block" width="400">
                            <p>
                                <b>3.</b> Data will be converted into a object like this:
                            </p>
                            <div class="bg-white" style="border-radius: 4px;">
                                <p class="mb-0 pt-2" style="border-top-left-radius: 4px; border-top-right-radius: 4px;">
                                </p>
                                <p class="mb-0 pl-2 bg-light"><span style="color: #859900;">db</span> = {</p>
                                <p class="mb-0 pl-2">&emsp;id: <span style="color: #2aa198;">"value"</span>,</p>
                                <p class="mb-0 pl-2 bg-light">&emsp;id2: [<span
                                        style="color: #2aa198;">"value1"</span>,<span
                                        style="color: #2aa198;">"value2"</span>,<span
                                        style="color: #2aa198;">"value3"</span>]</p>
                                <p class="mb-0 pl-2">};</p>
                                <p class="mb-0 pb-2 bg-light"
                                    style="border-bottom-left-radius: 4px; border-bottom-right-radius: 4px;"></p>
                            </div>
                        </div>
                        <div class="tab-pane fade show active" id="link" role="tabpanel" aria-labelledby="link-tab">
                            <p>
                                <b>4.</b> Go to <a href="javascript:" class="badge badge-light">File</a> > <a
                                    href="javascript:" class="badge badge-light">Publish to the web</a>
                            </p>
                            <img src="img/spreadsheet2.png" class="img-fluid mb-3 rounded mx-auto d-block" width="400">
                            <p>
                                <b>5.</b> Within the <b>Link</b> tab, select the <b>Sheet1</b> and as
                                a <b>Website</b>
                            </p>
                            <img src="img/spreadsheet3.png" class="img-fluid mb-3 rounded mx-auto d-block" width="400">
                            <p>
                                <b>6.</b> Paste the new generated link here:
                            </p>
                            <div class="input-group mb-3">
                                <input type="url" class="form-control"
                                    placeholder="https://docs.google.com/spreadsheets/d/e/..." id="convertURL">
                                <div class="input-group-append">
                                    <button class="btn btn-primary" type="button" onclick="convert()">Convert</button>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="usage" role="tabpanel" aria-labelledby="usage-tab">
                            <p>
                                <b>7.</b> Paste this tag <b>before</b> any of your JavaScript files:
                            </p>
                            <div class="bg-white mb-3" style="border-radius: 4px;">
                                <p class="mb-0 pt-2" style="border-top-left-radius: 4px; border-top-right-radius: 4px;">
                                </p>
                                <p class="mb-0 pl-2 bg-light">
                                    &lt;<span style="color: #268bd2;">script</span> <span
                                        style="color: #b58900;">src</span>=<span style="color: #2aa198;"
                                        id="linkScript">"https://db.10x.es/cache/[...].js"</span>&gt;&lt;/<span
                                        style="color: #268bd2;">script</span>&gt;
                                </p>
                                <p class="mb-0 pb-2"
                                    style="border-bottom-left-radius: 4px; border-bottom-right-radius: 4px;"></p>
                            </div>
                            <p>
                                <b>8.</b> Access your data by using the variable `<span
                                    style="color: #859900;">db</span>` in your js code:
                            </p>
                            <div class="bg-white mb-3" style="border-radius: 4px;">
                                <p class="mb-0 pt-2" style="border-top-left-radius: 4px; border-top-right-radius: 4px;">
                                </p>
                                <p class="mb-0 pl-2 bg-light">
                                    <span style="color: #268bd2;">console</span>.log( db.id )
                                </p>
                                <p class="mb-0 pl-2">
                                    &rarr;&nbsp;"<span style="color: #F77;">value</span>"
                                </p>
                                <p class="mb-0 pb-2 bg-light"
                                    style="border-bottom-left-radius: 4px; border-bottom-right-radius: 4px;"></p>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="refresh" role="tabpanel" aria-labelledby="refresh-tab">
                            <p>
                                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-info-circle mb-1"
                                    fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd"
                                        d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
                                    <path
                                        d="M8.93 6.588l-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588z" />
                                    <circle cx="8" cy="4.5" r="1" />
                                </svg> Once fetched the spreadsheet, the data will remain <b>cached</b> until you
                                manually
                                refresh:
                            </p>
                            <div class="input-group mb-3">
                                <input type="text" class="form-control"
                                    placeholder="https://docs.google.com/spreadsheets/d/e/..." id="refreshURL">
                                <div class="input-group-append">
                                    <button class="btn btn-primary" type="button" onclick="refresh()">Refresh</button>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="about" role="tabpanel" aria-labelledby="about-tab">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
        integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
        integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV"
        crossorigin="anonymous"></script>
    <script>
        var uri = window.localStorage.getItem('uri');
        var path = window.localStorage.getItem('path');
        try {
            if (uri && path) {
                $('#refreshURL')[0].value = atob(uri);
                $('#linkScript')[0].innerText = `"https://db.10x.es/` + path + `"`;
                $('#refresh-tab').tab('show');
            }
        } catch (e) {
            console.log(e)
        }
        function convert() {
            generate($('#convertURL')[0].value);
        }
        function refresh() {
            generate($('#refreshURL')[0].value);
        }
        function generate(id) {
            id = btoa(id);
            if (!id.length) return;
            let req = new XMLHttpRequest();
            var url = '/generate?url=' + id;
            req.open('GET', url, true);
            req.responseType = 'text';
            req.onreadystatechange = function () {
                if (req.readyState == 4) {
                    if (req.status == 200) {
                        $('#linkScript')[0].innerText = `"https://db.10x.es/` + req.response + `"`;
                        $('#alert')[0].innerHTML = success;
                        $('#usage-tab').tab('show');
                        window.localStorage.setItem('uri', id);
                        window.localStorage.setItem('path', req.response);
                    }
                    if (req.status == 400) {
                        $('#alert')[0].innerHTML = notfound;
                    }
                    if (req.status == 404) {
                        $('#alert')[0].innerHTML = notfound;
                    }
                    if (req.status == 414) {
                        $('#alert')[0].innerHTML = toolong;
                    }
                    if (req.status == 418) {
                        $('#alert')[0].innerHTML = teapot;
                    }
                    document.body.scroll({ top: 0, left: 0, behavior: 'smooth' });
                    console.log(req.status, req.response);
                }
            }.bind(this);
            req.send();
        }

        var success = `<div class="alert alert-success alert-dismissible fade show" role="alert">
    Link has been generated!
    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
    </button>
</div>`
        var toolong = `<div class="alert alert-danger alert-dismissible fade show" role="alert">
    The URL was <strong>too long</strong>. Make sure you haven't pasted it multiple times!
    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
    </button>
</div>`;
        var notfound = `<div class="alert alert-danger alert-dismissible fade show" role="alert" id="notfound">
    The server could not find your spreadsheet! Make sure the URL is correct and that it has been
    shared publicly.
    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
    </button>
</div>`;
        var teapot = `<div class="alert alert-warning alert-dismissible fade show" role="alert" id="notfound">
    Can't refresh spreadsheet! To preserve bandwidth refresh can only be made every <strong>2 minutes</strong>.
    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
    </button>
</div>`;
    </script>
</body>

</html>